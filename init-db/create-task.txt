CALL create_task(11111002, 101, 16546, 'some description', '2022-12-10 10:00:00'::TIMESTAMP WITHOUT TIME ZONE, 10::smallint); 

GRANT SELECT, INSERT ON TASK TO manager;

CREATE OR REPLACE PROCEDURE public.create_task(
	IN task_id integer,
	IN contact_person_id integer,
	IN executor integer,
	IN description text,
	IN deadline timestamp without time zone,
	IN priority smallint)
LANGUAGE 'sql'
AS $BODY$

INSERT INTO task (
	task_id,
	c_p_id,
	executor,
	creator,
	task_description,
	task_create_datetime,
	task_deadline_datetime
)
VALUES (
	task_id,
	contact_person_id,
	executor,
	to_regrole(CURRENT_USER),
	description,
	CURRENT_TIMESTAMP,
	deadline);

INSERT INTO task_status (
	task_id,
	task_status_name,
	task_priority)
VALUES (
	task_id,
	'NEW',
	priority);
	
$BODY$;


REVOKE ALL ON PROCEDURE public.delete_employee(integer) FROM PUBLIC;
GRANT EXECUTE ON PROCEDURE public.create_task(integer, integer, integer, text, timestamp without time zone, smallint) TO postgres, admin, manager;
